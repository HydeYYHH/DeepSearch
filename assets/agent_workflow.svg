<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="500" viewBox="0 0 1200 500">
  <defs>
    <style>
      .title{font:700 20px sans-serif;fill:#222}
      .label{font:600 16px sans-serif;fill:#222}
      .text{font:14px sans-serif;fill:#333}
      .box{fill:#f9fbff;stroke:#6c8ebf;stroke-width:2}
      .cond{fill:#eef7ff;stroke:#5a8fd8;stroke-width:2}
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#555"/>
    </marker>
  </defs>
  <text x="50" y="35" class="title">Agent Workflow (LangGraph)</text>

  <!-- Nodes -->
  <rect x="80" y="80" width="220" height="80" rx="8" class="box"/>
  <text x="100" y="110" class="label">trim_history</text>
  <text x="100" y="135" class="text">keep last 3 turns</text>

  <line x1="300" y1="120" x2="360" y2="120" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="360" y="80" width="240" height="80" rx="8" class="box"/>
  <text x="380" y="110" class="label">list_available_engines</text>

  <line x1="600" y1="120" x2="660" y2="120" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="660" y="80" width="220" height="80" rx="8" class="box"/>
  <text x="680" y="110" class="label">search_call</text>
  
  <!-- Conditional branching from search_call -->
  <rect x="660" y="200" width="220" height="60" rx="8" class="cond"/>
  <text x="670" y="235" class="text">if tool_calls then tool_node else summarize</text>

  <!-- tool_node branch -->
  <line x1="770" y1="160" x2="770" y2="200" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="400" y="280" width="220" height="80" rx="8" class="box"/>
  <text x="420" y="310" class="label">tool_node</text>
  <text x="420" y="335" class="text">execute tools, collect results</text>
  
  <!-- loop back to search_call -->
  <line x1="510" y1="360" x2="510" y2="420" stroke="#555" stroke-width="2"/>
  <line x1="510" y1="420" x2="770" y2="420" stroke="#555" stroke-width="2"/>
  <line x1="770" y1="420" x2="770" y2="160" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- summarize branch -->
  <line x1="880" y1="200" x2="940" y2="200" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="940" y="160" width="220" height="80" rx="8" class="box"/>
  <text x="960" y="190" class="label">summarize</text>

  <line x1="1060" y1="240" x2="1060" y2="300" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="940" y="300" width="220" height="80" rx="8" class="box"/>
  <text x="960" y="330" class="label">safety_check</text>

  <line x1="1060" y1="380" x2="1060" y2="440" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="940" y="440" width="220" height="80" rx="8" class="box"/>
  <text x="960" y="470" class="label">update_history</text>

  <!-- END -->
  <line x1="1160" y1="480" x2="1180" y2="480" stroke="#555" stroke-width="2"/>
  <text x="1185" y="485" class="label">END</text>

</svg>